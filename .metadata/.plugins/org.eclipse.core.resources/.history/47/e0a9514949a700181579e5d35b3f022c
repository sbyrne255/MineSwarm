package me.cutrats110;

import java.io.File;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.apache.commons.io.FileUtils;
import org.bukkit.Bukkit;
import org.bukkit.event.Listener;
import org.bukkit.plugin.Plugin;

public class ScheduledBackupDB implements Listener {
	public Plugin plugin;
	public Database db = null;
	
	public ScheduledBackupDB(Plugin instance) {
		plugin = instance;
		Bukkit.getServer().getPluginManager().registerEvents(this, plugin);
		this.db = new Database(plugin);
		backup();
		
	}
	public void backup(){
		Bukkit.getScheduler().scheduleSyncRepeatingTask(plugin, new Runnable() {
		    public void run() {
		    	plugin.getLogger().info("Scheduled Database Backup Starting...");
		    	String timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
		    	try {
		    		
			    	File source = new File(System.getProperty("user.dir") +"/plugins/mineswarmChests.db");
			    	File dest = new File(System.getProperty("user.dir") +"/"+ timeStamp + "mineswarmChests.db");
		    	    FileUtils.copyDirectory(source, dest);
		    	    
		    	    source = new File(System.getProperty("user.dir") +"/plugins/mobspawners.db");
			    	dest = new File(System.getProperty("user.dir") +"/"+ timeStamp + "mobspawners.db");
		    	    FileUtils.copyDirectory(source, dest);
		    	    
		    	    source = new File(System.getProperty("user.dir") +"/plugins/mineswarm.db");
			    	dest = new File(System.getProperty("user.dir") +"/"+ timeStamp + "mineswarm.db");
		    	    FileUtils.copyDirectory(source, dest);
		    	    
		    	} catch (IOException e) {
		    		plugin.getLogger().info(e.toString());
		    	} catch (Exception e) {
					plugin.getLogger().info(e.toString());
				}
		    	
		    }
		}, ((20*20)), ((20*20)));//Delay, length allowed to run...
		//20t = 1s
		//20*10 = 10 seconds...
	}
}
	