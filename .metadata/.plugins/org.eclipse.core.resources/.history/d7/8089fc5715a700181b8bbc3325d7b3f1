package me.cutrats110;

import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.block.Chest;
import org.bukkit.event.Listener;
import org.bukkit.inventory.ItemStack;
import org.bukkit.plugin.Plugin;

public class ScheduledChests implements Listener {
	public Plugin plugin;
	public Database db = null;
	private boolean debugging = true;
	
	public ScheduledChests(Plugin instance) {
		plugin = instance;
		Bukkit.getServer().getPluginManager().registerEvents(this, plugin);
		debugging = plugin.getConfig().getBoolean("debugging");
		this.db = new Database(plugin);
		chestSpawns();
		
	}
	
	
	public void chestSpawns(){
		Bukkit.getScheduler().scheduleSyncRepeatingTask(plugin, new Runnable() {
		    public void run() {
		    	if(debugging){plugin.getLogger().info("I am a scheduled task, running at a scheduled time!");}
		    	
		    	ResultSet rs = db.getChests();
		    	try {
					while (rs.next()) {
						Chest chest;
						try {
							chest = (Chest) new Location(Bukkit.getWorld(rs.getString("world")), rs.getInt("x"),rs.getInt("y"),rs.getInt("z")).getBlock().getState();
							List<String> items = Arrays.asList(rs.getString("items").split("\\s*,\\s*"));
							ItemStack[] contents = new ItemStack[(items.size()/2)];
							int j = 0;
							for(int i = 0; i < items.size(); i+=2) {//This builds my itemStack array...
								contents[j].setType(Material.getMaterial(items.get(i).toString()));
								contents[j].setAmount(Integer.valueOf(items.get(i+1)));
								j++;
								
								//chest.getBlockInventory().setContents(new ItemStack(Material.DIRT));
							}
						}catch(Exception err) {
							plugin.getLogger().info("Failed to cast block: " + err.toString());
						}
						
					}
				} catch (Exception e) {
					plugin.getLogger().info(e.toString());
				}
		    		    	
				ItemStack test = new ItemStack(Material.DIRT); //Creates a dirt ItemStack
				ItemStack test2 = new ItemStack(Material.STONE, 5); //Creates a dirt ItemStack
				ItemStack[] contents = {test, test2}; //Do whatever with it
				
		    }
		}, (20*20), (20*20));//Delay, length allowed to run...
		//20t = 1s
		//20*10 = 10 seconds...
	}
}
