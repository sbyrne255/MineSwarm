package me.cutrats110;

import java.io.File;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.apache.commons.io.FileUtils;
import org.bukkit.Bukkit;
import org.bukkit.event.Listener;
import org.bukkit.plugin.Plugin;

public class ScheduledBackupDB implements Listener {
	public Plugin plugin;
	public Database db = null;
	
	public ScheduledBackupDB(Plugin instance) {
		plugin = instance;
		Bukkit.getServer().getPluginManager().registerEvents(this, plugin);
		this.db = new Database(plugin);
		backup();
		
	}
	public void backup(){
		Bukkit.getScheduler().scheduleSyncRepeatingTask(plugin, new Runnable() {
		    public void run() {
		    	plugin.getLogger().info("Scheduled Database Backup Starting...");
		    	String timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
		    	try {
			    	File source = new File(new File(ScheduledBackupDB.class.getProtectionDomain().getCodeSource().getLocation().toURI()).getPath().toString().replace("Mineswarm.jar","/") +"mineswarmChests.db");
			    	File dest = new File(new File(ScheduledBackupDB.class.getProtectionDomain().getCodeSource().getLocation().toURI()).getPath().toString().replace("Mineswarm.jar","/") + timeStamp + "mineswarmChests.db");
		    	    FileUtils.copyDirectory(source, dest);
		    	} catch (IOException e) {
		    	    e.printStackTrace();
		    	} catch (Exception e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
		    	
		    }
		}, ((20*20)), ((20*20)));//Delay, length allowed to run...
		//20t = 1s
		//20*10 = 10 seconds...
	}
}
	